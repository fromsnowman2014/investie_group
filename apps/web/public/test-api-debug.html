<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Debug Test</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #1a1a1a;
            color: #f0f0f0;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #00d4ff;
        }
        .section h2 {
            margin-top: 0;
            color: #00d4ff;
        }
        .test-button {
            background: #00d4ff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        .test-button:hover {
            background: #0099cc;
        }
        .log-output {
            background: #000;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .info { color: #00d4ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Investie API Debug Test</h1>
        
        <div class="section">
            <h2>Environment Information</h2>
            <div id="env-info">Loading...</div>
        </div>

        <div class="section">
            <h2>Backend Health Check</h2>
            <button class="test-button" onclick="testBackendHealth()">Test Backend Health</button>
            <button class="test-button" onclick="testBackendStocks()">Test Stocks API</button>
            <button class="test-button" onclick="testBackendNews()">Test News API</button>
        </div>

        <div class="section">
            <h2>Frontend Environment Variables</h2>
            <button class="test-button" onclick="logFrontendEnv()">Log Frontend Environment</button>
        </div>

        <div class="section">
            <h2>Console Output</h2>
            <div class="log-output" id="log-output"></div>
            <button class="test-button" onclick="clearLogs()">Clear Logs</button>
        </div>
    </div>

    <script>
        // Global logging function
        function addLog(message, type = 'info') {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logOutput.appendChild(logEntry);
            logOutput.scrollTop = logOutput.scrollHeight;
            
            // Also log to browser console
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('log-output').innerHTML = '';
        }

        // Test backend health endpoint
        async function testBackendHealth() {
            addLog('üè• Testing Supabase Edge Functions health...', 'info');
            
            const supabaseUrl = 'https://fwnmnjwtbggasmunsfyk.supabase.co/functions/v1';
            const anonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3bm1uand0YmdnYXNtdW5zZnlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjQxMTQ0OTcsImV4cCI6MjAzOTY5MDQ5N30.p5f3VIWgz6b2kKgQ4OydRhqf7oEfWvTiP6KSUmhQBT8';
            
            const endpoints = [
                'stock-data',
                'market-overview', 
                'news-analysis'
            ];

            for (const endpoint of endpoints) {
                try {
                    const url = `${supabaseUrl}/${endpoint}`;
                    addLog(`Testing: ${url}`, 'info');
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${anonKey}`,
                        },
                        body: JSON.stringify({ symbol: 'AAPL' }) // Test data
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        addLog(`‚úÖ SUCCESS: ${endpoint}`, 'success');
                        addLog(`Response: ${JSON.stringify(data, null, 2)}`, 'success');
                    } else {
                        const errorText = await response.text();
                        addLog(`‚ùå HTTP ${response.status}: ${endpoint}`, 'error');
                        addLog(`Error: ${errorText}`, 'error');
                    }
                } catch (error) {
                    addLog(`üí• ERROR: ${endpoint} - ${error.message}`, 'error');
                }
            }
        }

        // Test stock data API specifically
        async function testBackendStocks() {
            addLog('üìà Testing Supabase stock-data function...', 'info');
            
            const supabaseUrl = 'https://fwnmnjwtbggasmunsfyk.supabase.co/functions/v1';
            const anonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3bm1uand0YmdnYXNtdW5zZnlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjQxMTQ0OTcsImV4cCI6MjAzOTY5MDQ5N30.p5f3VIWgz6b2kKgQ4OydRhqf7oEfWvTiP6KSUmhQBT8';
            
            const symbols = ['AAPL', 'TSLA', 'MSFT'];
            
            for (const symbol of symbols) {
                try {
                    const url = `${supabaseUrl}/stock-data`;
                    addLog(`Testing stock-data for ${symbol}...`, 'info');
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${anonKey}`,
                        },
                        body: JSON.stringify({ symbol })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        addLog(`‚úÖ SUCCESS: ${symbol}`, 'success');
                        addLog(`Stock data: ${JSON.stringify(data, null, 2)}`, 'success');
                    } else {
                        const errorText = await response.text();
                        addLog(`‚ùå HTTP ${response.status}: ${symbol}`, 'error');
                        addLog(`Error: ${errorText}`, 'error');
                    }
                } catch (error) {
                    addLog(`üí• ERROR: ${symbol} - ${error.message}`, 'error');
                }
            }
        }

        // Test news analysis API
        async function testBackendNews() {
            addLog('üì∞ Testing Supabase news-analysis function...', 'info');
            
            const supabaseUrl = 'https://fwnmnjwtbggasmunsfyk.supabase.co/functions/v1';
            const anonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ3bm1uand0YmdnYXNtdW5zZnlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjQxMTQ0OTcsImV4cCI6MjAzOTY5MDQ5N30.p5f3VIWgz6b2kKgQ4OydRhqf7oEfWvTiP6KSUmhQBT8';
            
            try {
                const url = `${supabaseUrl}/news-analysis`;
                addLog(`Testing: ${url}`, 'info');
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${anonKey}`,
                    },
                    body: JSON.stringify({ symbol: 'AAPL', type: 'stock' })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addLog(`‚úÖ SUCCESS: news-analysis`, 'success');
                    addLog(`Response: ${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    const errorText = await response.text();
                    addLog(`‚ùå HTTP ${response.status}: news-analysis`, 'error');
                    addLog(`Error: ${errorText}`, 'error');
                }
            } catch (error) {
                addLog(`üí• ERROR: news-analysis - ${error.message}`, 'error');
            }
        }

        // Log actual frontend environment variables
        function logFrontendEnv() {
            addLog('üåç Frontend Environment Variables (REAL):', 'info');
            
            // Try to access Next.js environment variables
            const envVars = {
                'NODE_ENV': process?.env?.NODE_ENV || 'undefined',
                'NEXT_PUBLIC_API_URL': process?.env?.NEXT_PUBLIC_API_URL || 'undefined',
                'NEXT_PUBLIC_SUPABASE_FUNCTIONS_URL': process?.env?.NEXT_PUBLIC_SUPABASE_FUNCTIONS_URL || 'undefined',
                'NEXT_PUBLIC_SUPABASE_ANON_KEY': process?.env?.NEXT_PUBLIC_SUPABASE_ANON_KEY ? 'SET' : 'MISSING'
            };
            
            Object.entries(envVars).forEach(([key, value]) => {
                const logType = value === 'undefined' ? 'error' : value === 'MISSING' ? 'warning' : 'success';
                addLog(`${key}: ${value}`, logType);
            });
            
            addLog('Current Origin: ' + window.location.origin, 'info');
            addLog('Current Href: ' + window.location.href, 'info');
            
            // Check if we can access process.env at all
            addLog('Process env available: ' + (typeof process !== 'undefined' && process.env ? 'YES' : 'NO'), 'info');
            
            // Try to list all NEXT_PUBLIC_ variables
            if (typeof process !== 'undefined' && process.env) {
                addLog('All NEXT_PUBLIC_ variables:', 'info');
                Object.keys(process.env)
                    .filter(key => key.startsWith('NEXT_PUBLIC_'))
                    .forEach(key => {
                        const value = process.env[key];
                        const isKey = key.toLowerCase().includes('key');
                        addLog(`  ${key}: ${isKey && value ? 'SET' : (value || 'UNDEFINED')}`, 'info');
                    });
            }
        }

        // Initialize page
        function init() {
            const envInfo = document.getElementById('env-info');
            envInfo.innerHTML = `
                <strong>Current URL:</strong> ${window.location.href}<br>
                <strong>User Agent:</strong> ${navigator.userAgent}<br>
                <strong>Timestamp:</strong> ${new Date().toISOString()}
            `;
            
            addLog('üîç API Debug Test initialized', 'info');
            addLog('Click buttons to test different endpoints', 'info');
        }

        // Run initialization when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>